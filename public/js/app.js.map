{"version":3,"sources":["app.js"],"names":["e","t","n","r","s","o","u","a","require","i","Error","f","exports","call","length","1","module","$","validate","BooksApp","that","this","init","prototype","books","checkStorage","$app","$books","$template","$form","$formButton","$alert","forEach","bookData","renderBook","editMode","setValidation","setEvents","show","localStorage","booksArr","JSON","parse","errorClass","rules","author","required","title","year","number","pages","messages","on","preventDefault","prop","editBook","addBook","showAlert","$book","target","closest","removeBook","fillForm","$newBook","clone","appendTo","find","text","attr","removeClass","index","getFormValues","push","updateStorage","data","remove","splice","$currentBook","removeAttr","hide","each","item","$item","key","val","stringify","message","css","setTimeout","empty","document","ready"],"mappings":"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","file":"app.js","sourcesContent":["var $ = require('jquery');\n$.validate = require('jquery-validation');\n\nvar BooksApp = function() {\n    var that = this;\n    that.init();\n}\n\nBooksApp.prototype = {\n\n    init: function() {\n        var that = this;\n        that.books = that.checkStorage() || [];\n        that.$app = $('.js-app');\n        that.$books = $('.js-books-block');\n        that.$template = $('.js-book-template');\n        that.$form = $('.js-form');\n        that.$formButton = $('.js-form-button');\n        that.$alert = $('.js-alert');\n        if (that.books != []) {\n            that.books.forEach(function(bookData, i) {\n                that.renderBook(bookData, i);\n            })\n        }\n        that.editMode = false;\n        that.setValidation();\n        that.setEvents();\n        that.$app.show();\n    },\n\n    checkStorage: function() {\n        if ('books' in localStorage) {\n            var booksArr = JSON.parse(localStorage.books);\n            if (booksArr.length > 0) {\n                return booksArr\n            }\n        }\n        return false\n    },\n\n    setValidation: function() {\n        var that = this;\n        that.$form.validate({\n        \terrorClass: 'book__field-alert js-field-alert',\n            rules: {\n                author: {\n                    required: true\n                },\n                title: {\n                \trequired: true\n                },\n                year: {\n                \trequired: true,\n                \tnumber: true\n                },\n                pages: {\n                \trequired: true,\n                \tnumber: true\n                },\n            },\n            messages: {\n            \tauthor: 'Введите автора',\n            \ttitle: 'Введите название',\n            \tyear: {\n            \t\trequired: 'Введите год',\n            \t\tnumber: 'Используйте только цифры'\n            \t},\n            \tpages: {\n            \t\trequired: 'Введите количество страниц',\n            \t\tnumber: 'Используйте только цифры'\n            \t}\n            }\n        });\n    },\n\n    setEvents: function() {\n        var that = this;\n        $('body')\n            .on('submit', that.$form, function(e) {\n                e.preventDefault();\n                that.$formButton.prop('disabled', true);\n                if (that.editMode) {\n                    that.editBook();\n                } else {\n                    that.addBook();\n                }\n                that.$formButton.prop('disabled', false);\n            })\n            .on('click', '.js-book-remove', function(e) {\n                if (!that.editMode) {\n                    var $book = $(e.target).closest('.js-book');\n                    that.removeBook($book);\n                } else {\n                    that.showAlert('Сохраните введенные изменения');\n                }\n            })\n            .on('click', '.js-book-edit', function(e) {\n                if (!that.editMode) {\n                    var $book = $(e.target).closest('.js-book');\n                    that.fillForm($book);\n                } else {\n                    that.showAlert('Сохраните введенные изменения');\n                }\n            });\n    },\n\n    renderBook: function(bookData, i) {\n        var that = this,\n            $newBook = that.$template.clone().appendTo(that.$books);\n        $newBook.find('.js-book-author').text(bookData.author);\n        $newBook.find('.js-book-title').text(bookData.title);\n        $newBook\n            .attr('data-index', i)\n            .removeClass('book__template')\n            .removeClass('js-book-template')\n    },\n\n    addBook: function() {\n        var that = this,\n            index = that.books.length,\n            bookData = that.getFormValues();\n        that.renderBook(bookData, index);\n        that.books.push(bookData);\n        that.updateStorage();\n    },\n\n    removeBook: function($book) {\n        var that = this,\n            index = $book.data('index');\n        $book.remove();\n        that.books.splice(index, 1);\n        that.updateStorage();\n    },\n\n    editBook: function() {\n        var that = this,\n            index = that.$form.data('current-index'),\n            bookData = that.getFormValues(),\n            $currentBook = that.$books.find('.js-book[data-index=' + index + ']');\n        $currentBook.find('.js-book-author').text(bookData.author);\n        $currentBook.find('.js-book-title').text(bookData.title);\n        that.books[index] = bookData;\n        that.updateStorage();\n        that.editMode = false;\n        that.$form.removeAttr('data-current-index');\n        that.$formButton.text('Добавить');\n    },\n\n    fillForm: function($book) {\n        var that = this,\n            index = $book.data('index'),\n            bookData = that.books[index];\n        $('label.js-field-alert').hide();\n        that.$form.find('input').each(function(i, item) {\n            var $item = $(item),\n                key = $item.attr('name'),\n                val = bookData[key];\n            $item.val(val);\n        })\n        that.$form.attr('data-current-index', index);\n        that.editMode = true;\n        that.$formButton.text('Сохранить');\n    },\n\n    getFormValues: function() {\n        var that = this,\n            bookData = {};\n        that.$form.find('input').each(function(i, item) {\n            var $item = $(item),\n                key = $item.attr('name'),\n                val = $item.val();\n            $item.val('');\n            bookData[key] = val;\n        });\n        return bookData;\n    },\n\n    updateStorage: function() {\n        var that = this;\n        localStorage.books = JSON.stringify(that.books);\n    },\n\n    showAlert: function(message) {\n        var that = this;\n        that.$alert.text(message).show().css('opacity', 1)\n        setTimeout(function() {\n            that.$alert.css('opacity', 0).empty().hide();\n        }, 2000);\n    },\n\n}\n\n$(document).ready(function() {\n    var booksApp = new BooksApp();\n});\n"]}